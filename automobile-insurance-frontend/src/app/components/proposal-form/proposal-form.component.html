<div class="proposal-container">
  <nav class="navbar">
    <div class="nav-brand">
      <i class="fas fa-car"></i>
      <span>AutoInsure</span>
    </div>
    <button class="nav-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
      Back to Dashboard
    </button>
  </nav>

  <div class="form-container">
    <div class="form-header">
      <h1>New Policy Proposal</h1>
      <p>Fill in the details below to get your vehicle insured</p>
    </div>

    <div class="alert alert-error" *ngIf="error">
      <i class="fas fa-exclamation-circle"></i>
      {{ error }}
      <div *ngIf="error.includes('Officer')" style="margin-top: 10px; font-size: 14px;">
        <strong>Note:</strong> To submit proposals, please:
        <ol style="margin: 5px 0; padding-left: 20px;">
          <li>Logout from your current account</li>
          <li>Login with a User account (not Officer)</li>
          <li>Use credentials like: jane.smith&#64;example.com / TestPassword456!</li>
        </ol>
      </div>
    </div>

    <div class="alert alert-success" *ngIf="success">
      <i class="fas fa-check-circle"></i>
      Proposal submitted successfully! Redirecting to dashboard...
    </div>

    <form (ngSubmit)="onSubmit()" class="proposal-form" *ngIf="!success">
      <div class="form-grid">
        <!-- Vehicle Type Section -->
        <div class="form-section">
          <h3>Vehicle Information</h3>
          
          <div class="form-group">
            <label for="vehicleType">Vehicle Type *</label>
            <select 
              id="vehicleType" 
              [(ngModel)]="proposal.vehicleType" 
              name="vehicleType"
              (change)="onVehicleTypeChange()"
              class="form-control"
              required>
              <option value="">Select Vehicle Type</option>
              <option *ngFor="let type of vehicleTypes" [value]="type.value">
                {{ type.label }} (Base Rate: ₹{{ type.baseRate | number }})
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="vehicleNumber">Vehicle Number *</label>
            <input 
              type="text" 
              id="vehicleNumber" 
              [(ngModel)]="proposal.vehicleNumber" 
              name="vehicleNumber"
              placeholder="e.g., MH-12-AB-1234"
              class="form-control"
              required>
            <small>Enter your vehicle registration number</small>
          </div>
        </div>

        <!-- Policy Package Section -->
        <div class="form-section">
          <h3>Policy Package</h3>
          
          <div class="form-group">
            <label for="policyPackage">Coverage Type *</label>
            <select 
              id="policyPackage" 
              [(ngModel)]="proposal.policyPackage" 
              name="policyPackage"
              (change)="onPolicyPackageChange()"
              class="form-control"
              required>
              <option value="">Select Policy Package</option>
              <option *ngFor="let package of policyPackages" [value]="package.name">
                {{ package.name }} - ₹{{ package.price | number }}
              </option>
            </select>
          </div>

          <!-- Selected Package Details -->
          <div class="package-details" *ngIf="proposal.policyPackage">
            <div class="selected-package">
              <h4>{{ proposal.policyPackage }}</h4>
              <ng-container *ngFor="let package of policyPackages">
                <div *ngIf="package.name === proposal.policyPackage">
                  <p class="package-description">{{ package.description }}</p>
                  <ul class="features-list">
                    <li *ngFor="let feature of package.features">
                      <i class="fas fa-check"></i>
                      {{ feature }}
                    </li>
                  </ul>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <!-- Premium Summary -->
      <div class="premium-summary" *ngIf="proposal.premiumAmount > 0">
        <div class="summary-card">
          <h3>Premium Summary</h3>
          <div class="summary-row">
            <span>Vehicle Type:</span>
            <span>{{ proposal.vehicleType }}</span>
          </div>
          <div class="summary-row">
            <span>Policy Package:</span>
            <span>{{ proposal.policyPackage }}</span>
          </div>
          <div class="summary-row total">
            <span>Total Premium:</span>
            <span class="amount">₹{{ proposal.premiumAmount | number }}</span>
          </div>
          <small>*Premium amount is calculated based on vehicle type and selected package</small>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="goBack()" [disabled]="loading">
          Cancel
        </button>
        
        <!-- Debug Info -->
        <div class="debug-info" style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; font-size: 12px;">
          <strong>Debug Info:</strong><br>
          Form Valid: {{ isFormValid() }}<br>
          Vehicle Type: {{ proposal.vehicleType || 'Not selected' }}<br>
          Vehicle Number: {{ proposal.vehicleNumber || 'Not entered' }}<br>
          Policy Package: {{ proposal.policyPackage || 'Not selected' }}<br>
          Premium Amount: {{ proposal.premiumAmount || 0 }}<br>
          User Email: {{ authService.getUserEmail() || 'Not logged in' }}
        </div>
        
        <button 
          type="submit" 
          class="btn-primary" 
          [disabled]="!isFormValid() || loading">
          <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
          <i class="fas fa-paper-plane" *ngIf="!loading"></i>
          {{ loading ? 'Submitting...' : 'Submit Proposal' }}
        </button>
      </div>
    </form>
  </div>
</div>
