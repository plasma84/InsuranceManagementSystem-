<div class="claims-container">
  <div class="claims-header">
    <h2>Insurance Claims</h2>
    <p>Submit and track your insurance claims</p>
    
    <!-- Quick Actions -->
    <div style="margin-top: 15px;">
      <button class="btn btn-success" (click)="navigateToNewProposal()" 
              style="margin-right: 10px; background-color: #28a745;">
        <i class="fas fa-plus"></i> New Policy Proposal
      </button>
      <button class="btn btn-info" (click)="navigateToDashboard()" 
              style="background-color: #17a2b8;">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </button>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-button"
      [class.active]="activeTab === 'submit'"
      (click)="setActiveTab('submit')">
      Submit New Claim
    </button>
    <button 
      class="tab-button"
      [class.active]="activeTab === 'view'"
      (click)="setActiveTab('view')">
      My Claims
    </button>
    <button 
      *ngIf="isOfficerOrAdmin"
      class="tab-button"
      [class.active]="activeTab === 'manage'"
      (click)="setActiveTab('manage')">
      Manage All Claims
    </button>
  </div>

  <!-- Submit Claim Tab -->
  <div class="tab-content" *ngIf="activeTab === 'submit'">
    <div class="submit-claim-section">
      <h3>Submit New Claim</h3>
      
      <!-- Show login prompt if not authenticated -->
      <div *ngIf="!authService.isAuthenticated()" class="login-prompt" style="background: #ffe6e6; padding: 20px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
        <h4>Authentication Required</h4>
        <p>You need to be logged in to submit a claim.</p>
        <button class="btn btn-primary" (click)="quickLogin()">Quick Login as Test User</button>
        <p style="margin-top: 10px; font-size: 12px;">
          This will log you in as: john.doe&#64;example.com
        </p>
      </div>
      
      <form [formGroup]="claimForm" (ngSubmit)="onSubmitClaim()" class="claim-form" 
            *ngIf="authService.isAuthenticated()">
        <div class="form-group">
          <label for="proposalId">Select Policy:</label>
          <select 
            id="proposalId" 
            formControlName="proposalId" 
            class="form-control"
            [disabled]="loading">
            <option value="">Choose a policy...</option>
            <option 
              *ngFor="let proposal of userProposals" 
              [value]="proposal.id">
              {{ proposal.vehicleType }} - {{ proposal.vehicleNumber }} ({{ proposal.policyPackage }})
            </option>
          </select>
          <div 
            class="error-message" 
            *ngIf="claimForm.get('proposalId')?.invalid && claimForm.get('proposalId')?.touched">
            Please select a policy.
          </div>
        </div>

        <div class="form-group">
          <label for="reason">Reason for Claim:</label>
          <textarea 
            id="reason"
            formControlName="reason"
            class="form-control"
            rows="5"
            placeholder="Please describe the incident or reason for your claim in detail..."
            [disabled]="loading">
          </textarea>
          <div 
            class="error-message" 
            *ngIf="claimForm.get('reason')?.invalid && claimForm.get('reason')?.touched">
            Please provide a detailed reason (minimum 10 characters).
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="claimForm.invalid || loading">
            <span *ngIf="loading" class="spinner"></span>
            {{ loading ? 'Submitting...' : 'Submit Claim' }}
          </button>
        </div>

        <div class="message" *ngIf="submitMessage" 
             [class.success]="submitMessage.includes('successfully')"
             [class.error]="submitMessage.includes('Error')">
          {{ submitMessage }}
        </div>
      </form>
    </div>
  </div>

  <!-- View Claims Tab -->
  <div class="tab-content" *ngIf="activeTab === 'view'">
    <div class="claims-list-section">
      <h3>My Claims</h3>
      
      <div *ngIf="loading" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading claims...</p>
      </div>

      <div *ngIf="!loading && claims.length === 0" class="no-claims-message">
        <i class="fas fa-file-contract"></i>
        <h4>No Claims Found</h4>
        <p>You haven't submitted any claims yet. Start by submitting your first claim.</p>
        <button class="btn btn-primary" (click)="setActiveTab('submit')" style="margin-top: 1rem;">
          <i class="fas fa-plus"></i>
          Submit Your First Claim
        </button>
      </div>

      <div *ngIf="!loading && claims.length > 0" class="claims-grid">
        <div *ngFor="let claim of claims" class="claim-card">
          <div class="claim-header">
            <h4>Claim Request #{{ claim.id }}</h4>
            <div class="claim-id">ID: {{ claim.id }}</div>
          </div>
          
          <div class="claim-status" [ngClass]="getStatusClass(claim.status)">
            <i class="fas" [ngClass]="{
              'fa-clock': claim.status === 'PENDING',
              'fa-check-circle': claim.status === 'APPROVED', 
              'fa-times-circle': claim.status === 'REJECTED',
              'fa-eye': claim.status === 'UNDER_REVIEW'
            }"></i>
            {{ getStatusDisplay(claim.status) }}
          </div>
          
          <div class="claim-details">
            <div class="detail-row">
              <div class="label">
                <i class="fas fa-calendar-alt"></i>
                Date Filed
              </div>
              <div class="value date">{{ formatDate(claim.dateFiled || '') }}</div>
            </div>
            
            <div class="detail-row" *ngIf="claim.proposal">
              <div class="label">
                <i class="fas fa-car"></i>
                Vehicle Policy
              </div>
              <div class="value">{{ claim.proposal.vehicleType }} - {{ claim.proposal.vehicleNumber }}</div>
            </div>
            
            <div class="detail-row">
              <div class="label">
                <i class="fas fa-info-circle"></i>
                Description
              </div>
              <div class="value">{{ claim.reason | slice:0:100 }}{{ claim.reason.length > 100 ? '...' : '' }}</div>
            </div>
          </div>

          <div class="claim-actions">
            <button class="btn btn-info" (click)="viewClaimDetails(claim)">
              <i class="fas fa-eye"></i>
              View Details
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Manage Claims Tab (Officer/Admin Only) -->
  <div class="tab-content" *ngIf="activeTab === 'manage' && isOfficerOrAdmin">
    <div class="claims-management-section">
      <h3>Manage All Claims</h3>
      
      <div *ngIf="loading" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading claims...</p>
      </div>

      <div *ngIf="!loading && allClaims.length === 0" class="no-claims-message">
        <i class="fas fa-clipboard-list"></i>
        <h4>No Claims to Manage</h4>
        <p>There are currently no claims in the system to review.</p>
      </div>

      <div *ngIf="!loading && allClaims.length > 0" class="claims-grid">
        <div *ngFor="let claim of allClaims" class="claim-card management-card">
          <div class="claim-header">
            <h4>Claim Request #{{ claim.id }}</h4>
            <div class="claim-id">ID: {{ claim.id }}</div>
          </div>
          
          <div class="claim-status" [ngClass]="getStatusClass(claim.status)">
            <i class="fas" [ngClass]="{
              'fa-clock': claim.status === 'PENDING',
              'fa-check-circle': claim.status === 'APPROVED', 
              'fa-times-circle': claim.status === 'REJECTED',
              'fa-eye': claim.status === 'UNDER_REVIEW'
            }"></i>
            {{ claim.status }}
          </div>
          
          <div class="claim-details">
            <div class="detail-row">
              <div class="label">
                <i class="fas fa-user"></i>
                Customer
              </div>
              <div class="value">{{ claim.user?.name || claim.user?.email || 'Unknown' }}</div>
            </div>
            
            <div class="detail-row">
              <div class="label">
                <i class="fas fa-calendar-alt"></i>
                Date Filed
              </div>
              <div class="value date">{{ formatDate(claim.dateFiled || '') }}</div>
            </div>
            
            <div class="detail-row" *ngIf="claim.proposal">
              <div class="label">
                <i class="fas fa-car"></i>
                Vehicle Policy
              </div>
              <div class="value">{{ claim.proposal.vehicleType }} - {{ claim.proposal.vehicleNumber }}</div>
            </div>
            
            <div class="detail-row">
              <div class="label">
                <i class="fas fa-info-circle"></i>
                Description
              </div>
              <div class="value">{{ claim.reason | slice:0:100 }}{{ claim.reason.length > 100 ? '...' : '' }}</div>
            </div>
          </div>

          <!-- Action Buttons for Pending Claims -->
          <div class="claim-actions" *ngIf="claim.status === 'PENDING'">
            <button 
              class="btn btn-success"
              (click)="updateClaimStatus(claim.id!, 'APPROVED')"
              [disabled]="loading">
              <i class="fas fa-check"></i> Approve
            </button>
            <button 
              class="btn btn-danger"
              (click)="updateClaimStatus(claim.id!, 'REJECTED')"
              [disabled]="loading">
              <i class="fas fa-times"></i> Reject
            </button>
          </div>

          <!-- Status Display for Processed Claims -->
          <div class="claim-actions" *ngIf="claim.status !== 'PENDING'">
            <button class="btn btn-info" disabled>
              <i class="fas fa-info-circle"></i>
              {{ claim.status === 'APPROVED' ? 'Approved' : 'Rejected' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
